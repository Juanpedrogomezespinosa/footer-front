<!-- Esta es la sección que se renderizará dentro del router-outlet del perfil -->
<section id="mis-datos">
  <!-- Cabecera -->
  <div class="flex flex-col p-4 pb-0 lg:p-0">
    <p
      class="text-text-light-primary text-3xl font-bold leading-tight tracking-tight"
    >
      Mis Datos Personales
    </p>
    <p
      class="text-text-light-secondary text-base font-normal leading-normal pt-2"
    >
      Actualiza tu información personal y de contacto.
    </p>
  </div>

  <!-- Estado de Carga -->
  <div *ngIf="loading" class="text-center py-10 text-gray-500">
    Cargando datos del perfil...
  </div>

  <!-- Formulario (cuando no está cargando) -->
  <div
    *ngIf="!loading"
    class="bg-white p-6 rounded-xl border border-gray-200 mt-6"
  >
    <form
      [formGroup]="profileForm"
      (ngSubmit)="onSubmit()"
      class="flex flex-col gap-6"
    >
      <!-- Fila 1: Nombre y Apellidos -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <label class="flex flex-col">
          <p class="text-text-light-primary text-sm font-medium pb-2">Nombre</p>
          <input
            formControlName="username"
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
          />
          <div
            *ngIf="f['username'].invalid && f['username'].touched"
            class="text-red-500 text-xs mt-1"
          >
            El nombre es obligatorio.
          </div>
        </label>

        <label class="flex flex-col">
          <p class="text-text-light-primary text-sm font-medium pb-2">
            Apellidos
          </p>
          <input
            formControlName="lastName"
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
          />
        </label>
      </div>

      <!-- Fila 2: Email y Teléfono -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <label class="flex flex-col">
          <p class="text-text-light-primary text-sm font-medium pb-2">Email</p>
          <input
            formControlName="email"
            type="email"
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
          />
          <div
            *ngIf="f['email'].invalid && f['email'].touched"
            class="text-red-500 text-xs mt-1"
          >
            El email debe ser válido.
          </div>
        </label>

        <label class="flex flex-col">
          <p class="text-text-light-primary text-sm font-medium pb-2">
            Teléfono
          </p>
          <input
            formControlName="phone"
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
          />
        </label>
      </div>

      <!-- Acciones del Formulario -->
      <div
        class="flex items-center gap-4 pt-4 border-t border-gray-200 flex-wrap"
      >
        <button
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 bg-secondary text-white gap-2 text-sm font-bold min-w-0 px-6 border-2 border-secondary hover:bg-secondary-dark transition-colors"
          type="button"
          (click)="openPasswordModal()"
        >
          Cambiar Contraseña
        </button>

        <button
          [disabled]="profileForm.invalid || submitting"
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 bg-secondary text-white gap-2 text-sm font-bold min-w-0 px-6 hover:bg-secondary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          type="submit"
        >
          <span *ngIf="submitting" class="animate-spin text-xl">↻</span>
          {{ submitting ? "Guardando..." : "Guardar Cambios" }}
        </button>
      </div>
    </form>
  </div>
</section>

<!--
  --- ¡COMPONENTE MODAL AÑADIDO AL FINAL! ---
  Se mostrará o ocultará basado en la variable 'showPasswordModal'
-->
<app-change-password-modal
  *ngIf="showPasswordModal"
  (close)="onModalClose()"
></app-change-password-modal>
