<main class="flex-1 w-full max-w-screen-xl mx-auto p-4 sm:p-6 lg:p-8">
  <div class="flex flex-col lg:flex-row gap-8">
    <aside class="lg:w-1/4 xl:w-1/5">
      <div class="flex flex-col gap-4 sticky top-28">
        <div class="flex items-center gap-3 mb-4">
          <div
            class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-12"
            [ngStyle]="avatarStyle"
            data-alt="User avatar"
          ></div>
          <div class="flex flex-col overflow-hidden">
            <h1
              class="text-text-light-primary text-base font-semibold leading-normal"
            >
              Bienvenido, {{ user?.username || "Cargando..." }}
            </h1>
            <p
              class="text-text-light-secondary text-sm font-normal leading-normal truncate"
            >
              {{ user?.email || "Cargando..." }}
            </p>
          </div>
        </div>

        <div class="flex flex-col gap-1 mt-4">
          <a
            class="flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors"
            routerLink="/profile"
            routerLinkActive="bg-secondary/10"
            [routerLinkActiveOptions]="{ exact: true }"
            #rlaMisDatos="routerLinkActive"
          >
            <span
              class="material-symbols-outlined"
              [ngClass]="{
                'text-secondary': rlaMisDatos.isActive,
                'text-text-light-primary': !rlaMisDatos.isActive
              }"
              >person</span
            >
            <p
              class="text-sm font-medium"
              [ngClass]="{
                'text-secondary font-semibold': rlaMisDatos.isActive,
                'text-text-light-primary': !rlaMisDatos.isActive
              }"
            >
              Mis Datos
            </p>
          </a>

          <a
            class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-gray-100 transition-colors"
            routerLink="/profile/addresses"
            routerLinkActive="bg-secondary/10"
            #rlaDirecciones="routerLinkActive"
          >
            <span
              class="material-symbols-outlined"
              [ngClass]="{
                'text-secondary': rlaDirecciones.isActive,
                'text-text-light-primary': !rlaDirecciones.isActive
              }"
              >location_on</span
            >
            <p
              class="text-sm font-medium"
              [ngClass]="{
                'text-secondary font-semibold': rlaDirecciones.isActive,
                'text-text-light-primary': !rlaDirecciones.isActive
              }"
            >
              Direcciones
            </p>
          </a>

          <a
            class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-gray-100 transition-colors"
            routerLink="/profile/orders"
            routerLinkActive="bg-secondary/10"
            #rlaPedidos="routerLinkActive"
          >
            <span
              class="material-symbols-outlined"
              [ngClass]="{
                'text-secondary': rlaPedidos.isActive,
                'text-text-light-primary': !rlaPedidos.isActive
              }"
              >receipt_long</span
            >
            <p
              class="text-sm font-medium"
              [ngClass]="{
                'text-secondary font-semibold': rlaPedidos.isActive,
                'text-text-light-primary': !rlaPedidos.isActive
              }"
            >
              Historial de Pedidos
            </p>
          </a>

          <a
            class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-gray-100 transition-colors mt-4"
            href="#"
            (click)="onLogout($event)"
          >
            <span class="material-symbols-outlined text-text-light-primary"
              >logout</span
            >
            <p class="text-text-light-primary text-sm font-medium">
              Cerrar Sesión
            </p>
          </a>
        </div>
      </div>
    </aside>

    <div class="lg:w-3/4 xl:w-4/5">
      <section id="mis-datos">
        <div class="flex flex-col p-4 pb-0">
          <p
            class="text-text-light-primary text-3xl font-bold leading-tight tracking-tight"
          >
            Mis Datos Personales
          </p>
          <p
            class="text-text-light-secondary text-base font-normal leading-normal pt-2"
          >
            Actualiza tu información personal y de contacto.
          </p>
        </div>

        <div *ngIf="loading" class="text-center py-10 text-gray-500">
          Cargando datos del perfil...
        </div>

        <div
          *ngIf="!loading"
          class="bg-white p-6 rounded-xl border border-gray-200 mt-6"
        >
          <form
            [formGroup]="profileForm"
            (ngSubmit)="onSubmit()"
            class="flex flex-col gap-6"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <label class="flex flex-col">
                <p class="text-text-light-primary text-sm font-medium pb-2">
                  Nombre
                </p>
                <input
                  formControlName="username"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
                />
                <div
                  *ngIf="
                    profileForm.controls['username'].invalid &&
                    profileForm.controls['username'].touched
                  "
                  class="text-red-500 text-xs mt-1"
                >
                  El nombre es obligatorio.
                </div>
              </label>

              <label class="flex flex-col">
                <p class="text-text-light-primary text-sm font-medium pb-2">
                  Apellidos
                </p>
                <input
                  formControlName="lastName"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
                />
              </label>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <label class="flex flex-col">
                <p class="text-text-light-primary text-sm font-medium pb-2">
                  Email
                </p>
                <input
                  formControlName="email"
                  type="email"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
                />
                <div
                  *ngIf="
                    profileForm.controls['email'].invalid &&
                    profileForm.controls['email'].touched
                  "
                  class="text-red-500 text-xs mt-1"
                >
                  El email debe ser válido.
                </div>
              </label>

              <label class="flex flex-col">
                <p class="text-text-light-primary text-sm font-medium pb-2">
                  Teléfono
                </p>
                <input
                  formControlName="phone"
                  class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-text-light-primary focus:outline-0 focus:ring-2 focus:ring-secondary focus:ring-opacity-50 border border-gray-300 bg-gray-50 h-12 placeholder:text-text-light-secondary px-4 text-base"
                />
                <p class="text-text-light-secondary text-xs mt-1">
                  Este campo se guarda en el servidor.
                </p>
              </label>
            </div>

            <div
              class="flex items-center gap-4 pt-4 border-t border-gray-200 flex-wrap"
            >
              <button
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 bg-secondary text-white gap-2 text-sm font-bold min-w-0 px-6 border-2 border-secondary hover:bg-secondary-dark transition-colors"
                type="button"
                (click)="
                  toastService.showError(
                    'Funcionalidad pendiente: Abrir modal de cambio de contraseña.'
                  )
                "
              >
                Cambiar Contraseña
              </button>

              <button
                [disabled]="profileForm.invalid || submitting"
                class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 bg-secondary text-white gap-2 text-sm font-bold min-w-0 px-6 hover:bg-secondary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                type="submit"
              >
                <span *ngIf="submitting" class="animate-spin text-xl">↻</span>
                {{ submitting ? "Guardando..." : "Guardar Cambios" }}
              </button>
            </div>
          </form>
        </div>
      </section>
      <router-outlet></router-outlet>
    </div>
  </div>
</main>
