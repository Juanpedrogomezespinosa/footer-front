<div
  (click)="close()"
  class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm animate-fade-in"
></div>

<div class="fixed inset-0 z-50 flex items-center justify-center p-4">
  <div
    class="relative w-full max-w-2xl max-h-[90vh] bg-white dark:bg-card-dark rounded-xl shadow-lg flex flex-col animate-scale-in"
    (click)="$event.stopPropagation()"
  >
    <div
      class="flex items-center justify-between p-4 border-b border-border-light dark:border-border-dark"
      *ngIf="user$ | async as user"
    >
      <h2
        class="text-xl font-bold text-text-light-primary dark:text-text-dark-primary"
      >
        Detalles de: {{ user.username }}
      </h2>
      <button
        (click)="close()"
        class="text-text-light-secondary hover:text-primary dark:hover:text-primary transition-colors rounded-full p-1"
      >
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <div
      class="flex-1 overflow-y-auto p-6 space-y-6"
      *ngIf="user$ | async as user"
    >
      <div
        class="border border-border-light dark:border-border-dark rounded-lg overflow-hidden"
      >
        <table
          class="w-full divide-y divide-border-light dark:divide-border-dark"
        >
          <tbody class="divide-y divide-border-light dark:divide-border-dark">
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary w-1/3"
              >
                ID de Usuario
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary"
              >
                {{ user.id }}
              </td>
            </tr>
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary"
              >
                Nombre
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary"
              >
                {{ user.username || "No especificado" }}
              </td>
            </tr>
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary"
              >
                Apellidos
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary"
              >
                {{ user.lastName || "No especificado" }}
              </td>
            </tr>
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary"
              >
                Email
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary"
              >
                {{ user.email }}
              </td>
            </tr>
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary"
              >
                Tel√©fono
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary"
              >
                {{ user.phone || "No especificado" }}
              </td>
            </tr>
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary"
              >
                Rol
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary capitalize"
              >
                {{ user.role }}
              </td>
            </tr>
            <tr>
              <th
                scope="row"
                class="px-4 py-3 text-left text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary"
              >
                Miembro desde
              </th>
              <td
                class="px-4 py-3 text-sm text-text-light-primary dark:text-text-dark-primary"
              >
                {{ user.created_at | date : "dd/MM/yyyy 'a las' HH:mm" }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="space-y-4 pt-4">
        <h3
          class="text-lg font-bold text-text-light-primary dark:text-text-dark-primary"
        >
          Direcciones
        </h3>

        <div
          *ngIf="!user.Addresses || user.Addresses.length === 0"
          class="p-4 bg-gray-100 border border-border-light dark:border-border-dark rounded-lg text-center text-sm text-text-light-secondary"
        >
          Este usuario no tiene direcciones guardadas.
        </div>

        <div
          *ngFor="let address of user.Addresses"
          class="p-4 bg-white border border-border-light dark:border-border-dark rounded-lg shadow-sm"
        >
          <div class="flex justify-between items-center mb-2">
            <h4
              class="text-md font-semibold text-text-light-primary dark:text-text-dark-primary capitalize"
            >
              {{ address.alias }}
            </h4>
            <span
              *ngIf="address.isDefault"
              class="px-2 py-0.5 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"
              >Principal</span
            >
          </div>
          <address class="text-sm text-text-light-secondary not-italic">
            {{ address.street }}<br />
            {{ address.city }}, {{ address.state }} {{ address.postalCode
            }}<br />
            {{ address.country }}<br />
            <span *ngIf="address.phone">Tel: {{ address.phone }}</span>
          </address>
        </div>
      </div>
    </div>

    <div
      class="flex items-center justify-end p-4 border-t border-border-light dark:border-border-dark space-x-2"
    >
      <button
        (click)="close()"
        type="button"
        class="px-4 py-2 rounded-lg text-sm font-medium text-white bg-secondary hover:opacity-90 transition-opacity"
      >
        Cerrar
      </button>
    </div>
  </div>
</div>
