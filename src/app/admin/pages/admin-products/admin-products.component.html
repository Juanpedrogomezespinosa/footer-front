<div class="flex flex-col gap-8 max-w-7xl mx-auto">
  <div class="flex flex-wrap justify-between items-center gap-4">
    <div class="flex flex-col gap-1">
      <p
        class="text-text-light-primary dark:text-text-dark-primary text-3xl font-bold leading-tight"
      >
        Gestión de Productos
      </p>
    </div>
    <button
      (click)="openProductModal()"
      class="flex items-center justify-center gap-2 px-4 py-2 bg-secondary text-white rounded-lg font-medium h-10 hover:opacity-90 transition-opacity"
    >
      <span>Añadir Producto</span>
    </button>
  </div>

  <form
    [formGroup]="filterForm"
    class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-card-light dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark shadow-sm"
  >
    <div>
      <label
        for="filter-name"
        class="block text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-1"
      >
        Buscar por nombre
      </label>
      <div class="relative">
        <div
          class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"
        >
          >
        </div>
        <input
          type="search"
          id="filter-name"
          formControlName="name"
          placeholder="Ej: Adidas Samba..."
          class="w-full pl-10 pr-4 py-2 border border-border-light rounded-lg bg-background-light focus:outline-none focus:ring-2 focus:ring-primary"
        />
      </div>
    </div>

    <div>
      <label
        for="filter-category"
        class="block text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-1"
      >
        Categoría
      </label>
      <select
        id="filter-category"
        formControlName="category"
        class="w-full p-2 border border-border-light rounded-lg bg-background-light focus:outline-none focus:ring-2 focus:ring-primary"
      >
        <option value="">Todas</option>
        <option value="zapatillas">Zapatillas</option>
        <option value="ropa">Ropa</option>
        <option value="complementos">Complementos</option>
      </select>
    </div>

    <div>
      <label
        for="filter-stock"
        class="block text-sm font-medium text-text-light-secondary dark:text-text-dark-secondary mb-1"
      >
        Stock
      </label>
      <select
        id="filter-stock"
        formControlName="stock"
        class="w-full p-2 border border-border-light rounded-lg bg-background-light focus:outline-none focus:ring-2 focus:ring-primary"
      >
        <option value="">Todos</option>
        <option value="true">Con Stock</option>
        <option value="false">Sin Stock</option>
      </select>
    </div>
  </form>
  <div *ngIf="productsResponse; else loading" class="flex flex-col gap-4">
    <div
      class="w-full overflow-x-auto rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark shadow-sm"
    >
      <table class="w-full text-left min-w-[1000px]">
        <thead class="border-b border-border-light dark:border-border-dark">
          <tr>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Imagen
            </th>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Nombre
            </th>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Categoría
            </th>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Precio
            </th>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Stock
            </th>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Detalles
            </th>
            <th
              class="p-4 text-sm font-semibold text-text-light-secondary dark:text-text-dark-secondary"
            >
              Acciones
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="productsResponse.products.length === 0">
            <td
              colspan="7"
              class="p-6 text-center text-text-light-secondary dark:text-text-dark-secondary"
            >
              No se encontraron productos con los filtros actuales.
            </td>
          </tr>
          <tr
            *ngFor="let product of productsResponse.products"
            class="border-b border-border-light dark:border-border-dark last:border-b-0 hover:bg-background-light dark:hover:bg-background-dark transition-colors"
          >
            <td class="p-4">
              <a
                [routerLink]="['/products', 'product', product.id]"
                target="_blank"
                class="block w-12 h-12 rounded-lg border border-border-light overflow-hidden group"
              >
                <img
                  [src]="
                    product.image ||
                    'https://placehold.co/64x64/eee/ccc?text=Sin+Img'
                  "
                  alt="Imagen de {{ product.name }}"
                  class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                />
              </a>
            </td>

            <td
              class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary font-medium"
            >
              <a
                [routerLink]="['/products', 'product', product.id]"
                target="_blank"
                class="hover:text-primary hover:underline transition-colors"
              >
                {{ product.name }}
              </a>
            </td>

            <td
              class="p-4 text-sm text-text-light-secondary dark:text-text-dark-secondary capitalize"
            >
              {{ product.category }}
            </td>

            <td
              class="p-4 text-sm text-text-light-primary dark:text-text-dark-primary font-medium"
            >
              {{ product.price | number : "1.2-2" }}€
            </td>

            <td class="p-4 text-sm">
              <span
                *ngIf="product.totalStock > 0; else noStock"
                class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"
              >
                {{ product.totalStock }} unidades
              </span>
              <ng-template #noStock>
                <span
                  class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800"
                >
                  Sin Stock
                </span>
              </ng-template>
            </td>

            <td class="p-4">
              <button
                (click)="onDetails(product.id)"
                class="text-blue-600 hover:underline text-sm font-medium"
              >
                Ver Detalles
              </button>
            </td>

            <td class="p-4">
              <div class="flex gap-2">
                <button
                  (click)="onEdit(product.id)"
                  class="text-primary hover:underline text-sm font-medium"
                >
                  Editar
                </button>
                <button
                  (click)="onDelete(product.id, product.name)"
                  class="text-red-600 hover:underline text-sm font-medium"
                >
                  Eliminar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div
      *ngIf="productsResponse.totalPages > 1"
      class="flex items-center justify-between p-4"
    >
      <span
        class="text-sm text-text-light-secondary dark:text-text-dark-secondary"
      >
        Página {{ productsResponse.currentPage }} de
        {{ productsResponse.totalPages }}
      </span>
      <div class="flex gap-2">
        <button
          (click)="onPrevPage()"
          [disabled]="!productsResponse.prevPage"
          class="px-4 py-2 rounded-lg text-sm font-medium text-text-light-secondary bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Anterior
        </button>
        <button
          (click)="onNextPage()"
          [disabled]="!productsResponse.nextPage"
          class="px-4 py-2 rounded-lg text-sm font-medium text-text-light-secondary bg-gray-100 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Siguiente
        </button>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="w-full text-center p-10">
    <p class="text-text-light-secondary dark:text-text-dark-secondary">
      Cargando productos...
    </p>
  </div>
</ng-template>
