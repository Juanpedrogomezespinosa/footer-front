<!-- Botón para abrir filtros (sin cambios) -->
<button
  #filterButton
  [class.hidden]="isMobileMenuOpen()"
  class="flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg fixed bottom-6 right-6 shadow-lg z-40 transition-all hover:bg-primary-dark"
  (click)="toggleFilters()"
  aria-label="Abrir filtros"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="currentColor"
    class="w-5 h-5"
    aria-hidden="true"
  >
    <path
      d="M3 5a1 1 0 0 1 1-1h16a1 1 0 0 1 .7 1.7L16 12.4V19a1 1 0 0 1-1.5.86L10 17.07V12.4L3.3 6.7A1 1 0 0 1 3 5z"
    />
  </svg>
  <span class="font-medium">Filtrar</span>
</button>

<!-- Contenido principal -->
<div class="max-w-7xl mx-auto px-4 py-10">
  <section>
    <!--
      --- ¡NUEVA CABECERA DE LISTA AÑADIDA! ---
      (Basada en el diseño objetivo)
    -->
    <div
      id="product-list-header"
      class="flex flex-col md:flex-row md:items-center md:justify-between mb-6"
    >
      <div>
        <h1 class="text-3xl font-bold text-text-light-primary tracking-tight">
          {{ listTitle() }}
        </h1>
        <p class="text-sm text-text-light-secondary mt-1">
          Mostrando {{ totalItems() }} productos
        </p>
      </div>
      <!-- Dropdown de Ordenación (Movido aquí desde el modal) -->
      <div class="mt-4 md:mt-0">
        <label for="sort" class="sr-only">Ordenar por:</label>
        <select
          id="sort"
          [value]="selectedSort"
          (change)="onSortChanged($event)"
          class="w-full md:w-auto p-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-secondary bg-white text-gray-800 text-sm"
        >
          <option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>
    <!-- --- FIN DE LA NUEVA CABECERA --- -->

    <!-- Grid de Productos -->
    <!--
      --- CLASE DE GRID MODIFICADA ---
      Cambiamos a un grid de 3 columnas en desktop
    -->
    <div
      *ngIf="products() && products().length > 0; else noProducts"
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
    >
      <app-product-card
        *ngFor="let product of products()"
        [product]="product"
      ></app-product-card>
    </div>

    <!-- Estado de no productos (sin cambios) -->
    <ng-template #noProducts>
      <div class="flex flex-col items-center justify-center py-20 text-center">
        <svg
          class="w-16 h-16 text-gray-400"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"
          />
        </svg>
        <h3
          class="mt-2 text-lg font-semibold text-text-primary-light dark:text-text-primary-dark"
        >
          No se encontraron productos
        </h3>
        <p
          class="mt-1 text-sm text-text-secondary-light dark:text-text-secondary-dark"
        >
          Prueba a cambiar los filtros o el término de búsqueda.
        </p>
      </div>
    </ng-template>

    <!--
      --- ¡NUEVA PAGINACIÓN NUMÉRICA! ---
      (Basada en el diseño objetivo)
    -->
    <div
      *ngIf="totalPages() > 1"
      class="flex justify-center items-center gap-2 mt-12"
    >
      <!-- Botón Anterior -->
      <button
        [disabled]="currentPage() <= 1"
        (click)="goToPreviousPage()"
        class="flex items-center justify-center h-10 w-10 rounded-lg border border-subtle-light dark:border-subtle-dark hover:bg-background-light dark:hover:bg-card-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        aria-label="Página anterior"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>

      <!-- Números de Página -->
      <ng-container *ngFor="let page of pageNumbers()">
        <button
          *ngIf="page !== -1"
          (click)="goToPage(page)"
          class="flex items-center justify-center h-10 w-10 rounded-lg border text-sm font-medium transition-colors"
          [ngClass]="{
            'bg-secondary text-white border-secondary': currentPage() === page,
            'border-subtle-light dark:border-subtle-dark hover:bg-background-light dark:hover:bg-card-dark':
              currentPage() !== page
          }"
        >
          {{ page }}
        </button>
        <!-- Puntos suspensivos (...) -->
        <span
          *ngIf="page === -1"
          class="flex items-center justify-center h-10 w-10 text-sm text-text-light-secondary"
        >
          ...
        </span>
      </ng-container>

      <!-- Botón Siguiente -->
      <button
        [disabled]="currentPage() >= totalPages()"
        (click)="goToNextPage()"
        class="flex items-center justify-center h-10 w-10 rounded-lg border border-subtle-light dark:border-subtle-dark hover:bg-background-light dark:hover:bg-card-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        aria-label="Página siguiente"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>
    </div>
  </section>
</div>

<!-- Sidebar de filtros (MODIFICADO) -->
<div
  *ngIf="showFilters"
  class="fixed inset-0 bg-black/80 backdrop-blur-sm flex justify-end z-50 transition-opacity duration-300"
  (click)="toggleFilters()"
  role="dialog"
  aria-modal="true"
>
  <div
    class="bg-white w-80 sm:w-96 h-full flex flex-col transform transition-transform duration-300 ease-in-out translate-x-0"
    (click)="$event.stopPropagation()"
    role="document"
  >
    <div
      class="flex items-center justify-between p-4 border-b border-subtle-light"
    >
      <h2 class="text-lg font-semibold text-primary">Filtros</h2>
      <button
        class="text-gray-500 hover:text-secondary"
        (click)="toggleFilters()"
        aria-label="Cerrar filtros"
      >
        ✕
      </button>
    </div>

    <!-- Contenido del Filtro -->
    <div class="flex-1 overflow-y-auto p-4">
      <!--
        --- ¡MODIFICADO! ---
        Se ha quitado (sortChanged)
      -->
      <app-products-filters
        (filtersChanged)="onFiltersChanged($event)"
      ></app-products-filters>
    </div>

    <!-- Botón de Aplicar -->
    <div class="border-t border-subtle-light p-4">
      <button
        class="w-full bg-secondary text-white py-2.5 rounded-lg font-semibold hover:bg-secondary/90 transition-colors"
        (click)="toggleFilters()"
        type="button"
      >
        Aplicar filtros
      </button>
    </div>
  </div>
</div>
